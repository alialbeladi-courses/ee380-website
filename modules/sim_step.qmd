---
title: "Simulation: Step Response"
format: html
filters:
  - shinylive
  - pyodide
---

This module demonstrates two ways to add interactivity to your course notes.

## 1. Virtual Lab (Shinylive)

This specific app runs entirely in your browser. It visualizes the step response of a second-order system. Students can manipulate the Damping Ratio ($\zeta$) and Natural Frequency ($\omega_n$) to see the effect on overshoot and settling time.

```{shinylive-python}
#| standalone: true
#| viewerHeight: 500
from shiny import App, ui
import numpy as np
import matplotlib.pyplot as plt

app_ui = ui.page_fluid(
    ui.layout_sidebar(
        ui.sidebar(
            ui.input_slider("zeta", "Damping Ratio (ζ)", 0.0, 2.0, 0.4, step=0.1),
            ui.input_slider("omega", "Natural Freq (ωn)", 1.0, 10.0, 3.0),
        ),
        ui.output_plot("plot")
    )
)

def server(input, output, session):
    @output
    @ui.render.plot
    def plot():
        t = np.linspace(0, 10, 500)
        zeta = input.zeta()
        wn = input.omega()
        
        # Step response for 2nd order system: G(s) = wn^2 / (s^2 + 2*zeta*wn*s + wn^2)
        plt.figure(figsize=(10, 6))
        
        # Avoid division by zero
        if wn == 0: wn = 0.01
        
        # 1. Undamped (zeta = 0)
        if zeta == 0:
            y = 1 - np.cos(wn * t)
            
        # 2. Underdamped (0 < zeta < 1)
        elif zeta < 1.0:
            wd = wn * np.sqrt(1 - zeta**2)
            phi = np.arctan(np.sqrt(1 - zeta**2) / zeta)
            y = 1 - (1 / np.sqrt(1 - zeta**2)) * np.exp(-zeta * wn * t) * np.sin(wd * t + phi)
            
        # 3. Critically Damped (zeta = 1)
        elif zeta == 1.0:
            y = 1 - (1 + wn * t) * np.exp(-wn * t)
            
        # 4. Overdamped (zeta > 1)
        else:
            p1 = -zeta * wn + wn * np.sqrt(zeta**2 - 1)
            p2 = -zeta * wn - wn * np.sqrt(zeta**2 - 1)
            y = 1 + (p2 * np.exp(p1 * t) - p1 * np.exp(p2 * t)) / (p1 - p2)

        plt.plot(t, y, lw=2, label='Response')
        plt.axhline(1, color='gray', linestyle='--', alpha=0.5, label='Target')
        plt.title(f"Step Response (ζ={zeta}, ωn={wn})")
        plt.xlabel("Time (s)")
        plt.ylabel("Amplitude")
        plt.grid(True, alpha=0.3)
        plt.ylim(-0.5, 2.0)
        plt.legend()

app = App(app_ui, server)
```

## 2. Live Calculation (Pyodide)

For homework problems, students can write run this code directly. Try changing the values below and running it again.

```{pyodide-python}
import numpy as np

# System parameters
zeta = 0.4
wn = 3.0

# Calculate settling time (4 * tau)
tau = 1 / (zeta * wn)
Ts = 4 * tau

print(f"System Parameters:")
print(f"  Damping Ratio: {zeta}")
print(f"  Natural Freq:  {wn} rad/s")
print(f"---------------------------")
print(f"Time Constant:   {tau:.3f} s")
print(f"Settling Time:   {Ts:.3f} s")
```
